(function(){if(typeof JSON!=="object"){var JSON=window.JSON={}}(function(){"use strict";var rx_one=/^[\],:{}\s]*$/;var rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;var rx_four=/(?:^|:|,)(?:\s*\[)+/g;var rx_escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function f(n){return n<10?"0"+n:n}function this_value(){return this.valueOf()}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};Boolean.prototype.toJSON=this_value;Number.prototype.toJSON=this_value;String.prototype.toJSON=this_value}var gap;var indent;var meta;var rep;function quote(string){rx_escapable.lastIndex=0;return rx_escapable.test(string)?'"'+string.replace(rx_escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i;var k;var v;var length;var mind=gap;var partial;var value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else if(typeof space==="string"){indent=space}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k;var v;var value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);rx_dangerous.lastIndex=0;if(rx_dangerous.test(text)){text=text.replace(rx_dangerous,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}})();var page={init:function(){this.key=+new Date;this.bindEvent();this.getOS();this.IMAGE_URL="//analy.tuniu.cn/analysisCollect/pcEvent.gif";this.postCache()},postCache:function(){var _=this;var cache=_.getCache();if(cache){cache=JSON.parse(cache);for(var i=0;i<cache.length;i++){delete cache[i].key}var image=new Image;image.onload=image.onerror=function(){image=null;_.clearCache()};image.src=_.IMAGE_URL+"?"+_.makeQueryString(cache)}},makeQueryString:function(cache){var _=this,arr=[];var json={sid:_.getSid(),sr:screen.width+"*"+screen.height,sc:screen.colorDepth,hw:window.innerHeight+"*"+window.innerWidth,os:_.getOSName(),bt:_.getBrowserName(),bv:_.browser.version,storage:cache,co:"_taca ="+_.getCookie("_taca")+";tuniuuser="+_.getCookie("tuniuuser")+";_tact="+_.getCookie("_tact")+";tuniu_partner="+_.getCookie("tuniu_partner")+";tuniuuser_id="+_.getCookie("tuniuuser_id")+";tuniuuser_citycode="+_.getCookie("tuniuuser_citycode")+";client_type="+(_.os.phone?20:0)};for(var i in json){arr.push(i+"="+encodeURIComponent(typeof json[i]=="string"?json[i]:JSON.stringify(json[i])))}return arr.join("&")},getSid:function(){var loginTime=new Date;var s=""+loginTime,a="",b="",y;s=s.substr(s.length-8);for(var i=0;i<s.length;i++){y=Math.floor(Math.random()*10);b+=y;a+=s.charCodeAt(i)<<y}return b+a},getOS:function(){var ua=navigator.userAgent,platform=navigator.platform;var os=this.os={},browser=this.browser={},webkit=ua.match(/Web[kK]it[\/]{0,1}([\d.]+)/),android=ua.match(/(Android);?[\s\/]+([\d.]+)?/),osx=!!ua.match(/\(Macintosh\; Intel /),ipad=ua.match(/(iPad).*OS\s([\d_]+)/),ipod=ua.match(/(iPod)(.*OS\s([\d_]+))?/),iphone=!ipad&&ua.match(/(iPhone\sOS)\s([\d_]+)/),webos=ua.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),win=/Win\d{2}|Windows/.test(platform),wp=ua.match(/Windows Phone ([\d.]+)/),touchpad=webos&&ua.match(/TouchPad/),kindle=ua.match(/Kindle\/([\d.]+)/),silk=ua.match(/Silk\/([\d._]+)/),blackberry=ua.match(/(BlackBerry).*Version\/([\d.]+)/),bb10=ua.match(/(BB10).*Version\/([\d.]+)/),rimtabletos=ua.match(/(RIM\sTablet\sOS)\s([\d.]+)/),playbook=ua.match(/PlayBook/),chrome=ua.match(/Chrome\/([\d.]+)/)||ua.match(/CriOS\/([\d.]+)/),firefox=ua.match(/Firefox\/([\d.]+)/),firefoxos=ua.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),ie=ua.match(/MSIE\s([\d.]+)/)||ua.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),webview=!chrome&&ua.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),safari=webview||ua.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);if(browser.webkit=!!webkit)browser.version=webkit[1];if(android)os.android=true,os.version=android[2];if(iphone&&!ipod)os.ios=os.iphone=true,os.version=iphone[2].replace(/_/g,".");if(ipad)os.ios=os.ipad=true,os.version=ipad[2].replace(/_/g,".");if(ipod)os.ios=os.ipod=true,os.version=ipod[3]?ipod[3].replace(/_/g,"."):null;if(win)os.win=true;if(wp)os.wp=true,os.version=wp[1];if(webos)os.webos=true,os.version=webos[2];if(touchpad)os.touchpad=true;if(blackberry)os.blackberry=true,os.version=blackberry[2];if(bb10)os.bb10=true,os.version=bb10[2];if(rimtabletos)os.rimtabletos=true,os.version=rimtabletos[2];if(playbook)browser.playbook=true;if(kindle)os.kindle=true,os.version=kindle[1];if(silk)browser.silk=true,browser.version=silk[1];if(!silk&&os.android&&ua.match(/Kindle Fire/))browser.silk=true;if(chrome)browser.chrome=true,browser.version=chrome[1];if(firefox)browser.firefox=true,browser.version=firefox[1];if(firefoxos)os.firefoxos=true,os.version=firefoxos[1];if(ie)browser.ie=true,browser.version=ie[1];if(safari&&(osx||os.ios||win)){browser.safari=true;if(!os.ios)browser.version=safari[1]}if(webview)browser.webview=true;os.tablet=!!(ipad||playbook||android&&!ua.match(/Mobile/)||firefox&&ua.match(/Tablet/)||ie&&!ua.match(/Phone/)&&ua.match(/Touch/));os.phone=!!(!os.tablet&&!os.ipod&&(android||iphone||webos||blackberry||bb10||chrome&&ua.match(/Android/)||chrome&&ua.match(/CriOS\/([\d.]+)/)||firefox&&ua.match(/Mobile/)||ie&&ua.match(/Touch/)))},getOSName:function(){var platform="not set",isWin=navigator.platform=="Win32"||navigator.platform=="Windows",isMac=navigator.platform=="Mac68K"||navigator.platform=="MacIntel"||navigator.platform=="MacPPC"||navigator.platform=="Macintosh",isUnix=navigator.platform=="X11"&&!isWin&&!isMac;if(isMac){platform="Mac"}if(isUnix){platform="Unix"}if(String(navigator.platform).indexOf("Linux")>-1)platform="Linux";if(isWin){if(navigator.userAgent.indexOf("Win95")>-1||navigator.userAgent.indexOf("Windows 95")>-1){platform="windows 95"}if(navigator.userAgent.indexOf("Win98")>-1||navigator.userAgent.indexOf("Windows 98")>-1){platform="windows 98"}if(navigator.userAgent.indexOf("Windows 9x 4.90")>-1||navigator.userAgent.indexOf("Windows ME")>-1){platform="windows ME"}if(navigator.userAgent.indexOf("Windows NT 5.0")>-1||navigator.userAgent.indexOf("Windows 2000")>-1){platform="windows 2000"}if(navigator.userAgent.indexOf("Windows NT 5.1")>-1||navigator.userAgent.indexOf("Windows XP")>-1){platform="windows XP"}if(navigator.userAgent.indexOf("Windows NT 5.2")>-1||navigator.userAgent.indexOf("Windows 2003")>-1){platform="windows 2003"}if(navigator.userAgent.indexOf("Windows NT 6.0")>-1||navigator.userAgent.indexOf("Windows Vista")>-1){platform="Windows Vista"}if(navigator.userAgent.indexOf("Windows NT 6.1")>-1||navigator.userAgent.indexOf("Windows 7")>-1)platform="Win7";if(navigator.userAgent.indexOf("Windows NT 6.2")>-1||navigator.userAgent.indexOf("Windows 8")>-1){platform="Win8"}}var android=navigator.userAgent.match(/(Android)[\s\/]+([\d\.]+)/);var iPad=navigator.userAgent.match(/iPad/i);var iPhone=navigator.userAgent.match(/iPhone/i);var iPod=navigator.userAgent.match(/iPod/i);var windowsPhone=navigator.userAgent.match(/(Windows\s+Phone)\s([\d\.]+)/);if(android){platform="Android"}if(iPad){platform="iOS-Pad"}if(iPhone){platform="iOS-Phone"}if(iPod){platform="iOS-Pod"}if(windowsPhone){platform="WindowsPhone"}return platform},getBrowserName:function(){if(this.browser.chrome){return"chrome"}if(this.browser.safari){return"safari"}if(this.browser.firefox){return"firefox"}if(this.browser.ie){return"ie"}return"android"},getCookie:function(r){var arr=document.cookie.match(new RegExp("(^| )"+r+"=([^;]*)(;|$)"));if(arr!==null){return arr[2]}else{return""}},collect:function(e){var _=this;e=e||window.event;var tar=e?e.target:e.srcElement;var m;while(tar.parentNode){if(tar.nodeName=="BODY"||tar.nodeName=="HTML"){break}if(m=tar.getAttribute("m")){_.saveClick(m,e.clientX,e.clientY)}tar=tar.parentNode}},clearCache:function(){var date=new Date;date.setDate(date.getDate()-1);document.cookie="clickCache=; expires="+date.toUTCString()+"; domain=tuniu.com; path=/"},saveCache:function(str){var date=new Date;date.setDate(date.getDate()+7);document.cookie="clickCache="+encodeURIComponent(str)+"; expires="+date.toUTCString()+"; domain=tuniu.com; path=/"},getCache:function(){return decodeURIComponent(this.getCookie("clickCache"))},saveClick:function(text,x,y){var _=this;var o={text:text,x:x,y:y,lg:+new Date};var cache=_.getCache()||"[]";cache=JSON.parse(cache);var hasPageData=false;for(var i=0;i<cache.length;i++){if(cache[i].key==_.key){hasPageData=true;cache[i].events.push(o);break}}if(!hasPageData){cache.push({key:_.key,url:window.location.href,pageName:window.PageName||"",referer:document.referrer||"",events:[o]})}_.saveCache(JSON.stringify(cache))},bindEvent:function(){var _=this;_.domReady(function(){_.addEvent(document.body,"click",function(e){_.collect(e)})})},domReady:function(fn){setTimeout(fn,0)},addEvent:function(el,type,handle){if(el.addEventListener){el.addEventListener(type,handle,false)}else{el.attachEvent(type,handle)}}};page.init()})();