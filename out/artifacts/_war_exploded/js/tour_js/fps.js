;(function(){function getCookie(name){var arr=document.cookie.split('; '),i=0,len=arr.length;for(;i<len;i++){var arr2=arr[i].split('=');if(arr2[0]==name){return decodeURIComponent(arr2[1]);}}
return null;}
var formatParams=function(data){var arr=[];for(var name in data){arr.push(encodeURIComponent(name)+'='+encodeURIComponent(data[name]));}
return arr.join('&');}
var jsonp=function(options){options=options||{};if(!options.url||!options.callback){throw new Error("参数不合法");}
var callbackName=('jsonp_'+Math.random()).replace(".","");var oHead=document.getElementsByTagName('head')[0];var params="";if(options.data){options.data[options.callback]=callbackName;params+=formatParams(options.data);}else{params+=options.callback+"="+callbackName;}
var oS=document.createElement('script');oHead.appendChild(oS);window[callbackName]=function(json){oHead.removeChild(oS);clearTimeout(oS.timer);window[callbackName]=null;options.success&&options.success(json);};oS.src=options.url+'?'+params;if(options.time){oS.timer=setTimeout(function(){window[callbackName]=null;oHead.removeChild(oS);options.fail&&options.fail({message:"超时"});},options.time);}};function isApp(){return document.cookie.indexOf("deviceType")!=-1||!!localStorage.getItem("zipLocation");}
function getAppVersion(){var AppVersion='8.1.6';if(localStorage.getItem("appVersion")){AppVersion=localStorage.getItem("appVersion");}else{var versionCookie=document.cookie.match(/appVersion=([\.|\d]+)/);if(versionCookie&&versionCookie[1]){AppVersion=versionCookie[1];}}
return AppVersion;}
function isMweb(){var userAgentInfo=navigator.userAgent;var Agents=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];var flag=false;for(var v=0;v<Agents.length;v++){if(userAgentInfo.indexOf(Agents[v])>0){flag=true;break;}}
return flag;}
function isShowChatEntry(options,callbackHandler){var d={};if(options.productId){d={productId:options.productId,productType:options.productType}}else if(options.orderId){d={orderId:options.orderId,orderType:options.orderType}}
if(typeof options.productType!='undefined'){d.productType=options.productType;}
if(options.userId){d.userId=options.userId;}
d.entryTemplateId=options.entryTemplateId;if(options.appVersion){d.appVersion=options.appVersion;}else{d.appVersion=getAppVersion();}
if(options.ct){d.ct=options.ct;}else if(getCookie('deviceType')==0){d.ct=10;}else if(getCookie('deviceType')==1){d.ct=20;}else if(/m.tuniu.com/.test(location.host)||isMweb()){d.ct=30;}else{d.ct=100;}
if(options.parameters){d.parameters=options.parameters;}else{d.parameters={};d.parameters.entranceUrl=encodeURIComponent(location.pathname+location.search);}
if(d.ct==100&&d.entryTemplateId==10001){callbackHandler({groupId:-1,status:true,url:encodeURIComponent('http://www.tuniu.com/kefu/center')});return;}
d=JSON.stringify(d);jsonp({url:"//m.tuniu.com/japi/chat/api/entryService/isShowChatEntry",callback:"cb",data:{cb:'jsoncallback',d:d},success:function(res){if(options.rewriteChatAppUrl&&isApp()&&res.success&&res.data.status&&res.data.url){if(navigator.userAgent.toLowerCase().indexOf('android')>-1){res.data.status=false;res.data.url='';}else{res.data.url=getOnlineChatAppUrl(res.data.groupId,options.productId,options.productType);}}
callbackHandler(res.data);},error:function(){callbackHandler({"actionType":-1,"containerId":-1,"entryCategory":-1,"groupId":-1,"status":false,"url":""});}})}
function getOnlineChatAppUrl(groupId,productId,productType){var params={"category_id":448,"consult_entrance_type":1,"destination_group_info":{"groupId":groupId,"orderId":'',"orderType":'',"presentedGroupName":"预订客服","productId":productId,"productType":productType},"entrance_url":"","faq":false,"faq_protocol_url":"","from_faq_protocol":false,"line_type":-1,"need_check_order":false,"order_id":'',"product_id":productId,"product_type":productType,"template_id":18};return'tuniuapp://page?iosPageName=TNChatCustomConsultMessageViewController&entryStyle=0&animated=1&androidPageName=com.tuniu.chat.activity.ConsultActivity&pluginType=9&parameters='+JSON.stringify(params);}
if(typeof window.TNCHAT_isShowChatEntry=='undefined'){window.TNCHAT_isShowChatEntry=isShowChatEntry;}})();
;+function(e){e.requestAnimationFrame=e.requestAnimationFrame||e.webkitRequestAnimationFrame;e.d=e.d instanceof Date?e.d:new Date;var t=navigator.userAgent;var n=e.location.protocol;var r={u:e.location.href,s:e.screen.width+"x"+e.screen.height,f:0,l:0,t:0,o:0,r:0,a:9,rd:-1,dns:-1,c:-1,rq:-1,rs:-1,i:-1,dcl:-1,dc:-1,dl:-1,or:0,rr:-1,ar:-1,sp:0,fp:-1,fcp:-1,rl:-1,e:e.elk||""};var a=document.cookie.match(new RegExp("(^| )deviceType=([^;]*)(;|$)"));if(a){r.a=+a[2]}if(e.localStorage&&e.localStorage.getItem("deviceType"))r.a=+e.localStorage.getItem("deviceType");if(/ipad/gi.test(t)){r.a=3}if(!/ipad|iphone|ipod|android|windows phone/gi.test(t)){r.a=4}if(n=="https:"){r.a=+r.a+10}var i=20;var o=new Date;var d=0;var s=0;var c=new Date;function f(){if(e.requestAnimationFrame){e.requestAnimationFrame(function(){d++;var t=new Date;if(t-c>1e3){var n=s*1e3/(t-c);if(/fps/i.test(e.location.href))u(n);if(n<r.l||r.l==0){r.l=n>>0;r.t=document.body.scrollTop||document.documentElement.scrollTop||0}c=t;s=0}s++;f()})}}function u(e){var t=document.getElementById("FPS");if(!t){t=document.createElement("div");t.style.cssText="position:fixed;right:0px;top:0px;font-size:12px;color:#fff;background-color:#666;";t.id="FPS";document.body.appendChild(t)}t.innerHTML=e}function l(e,t,n){if(e.addEventListener){e.addEventListener(t,n,false)}else{e.attachEvent("on"+t,n)}}function p(){var e=/msie\s+([\w\.]+)/i.exec(navigator.userAgent);if(e&&parseInt(e[1])<=9){return true}return false}function m(e){var t=document.getElementsByTagName("head")[0];var n=document.createElement("script");var r=false;n.async="async";t.insertBefore(n,t.firstChild);n.onload=n.onreadystatechange=function(){if(!r&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){t.removeChild(n);r=true}};n.src=e}l(e,"load",function(){r.o=new Date-e.d});var v={p:e.performance||e.webkitPerformance||e.msPerformance||e.mozPerformance,isSupport:function(){return!!this.p},format:function(t){t.sp=this.isSupport()?1:0;t.or=t.r;if(t.sp){var n=this.p.timing;t.dns=n.domainLookupEnd-n.domainLookupStart;t.c=n.connectEnd-n.connectStart;t.rq=n.responseStart-n.requestStart;t.rs=n.responseEnd-n.responseStart;t.i=n.domInteractive-n.domLoading;t.dcl=n.domContentLoadedEventStart-n.domLoading;t.dc=n.domComplete-n.domLoading;t.dl=n.domContentLoadedEventEnd-n.navigationStart;if(n.redirectStart>0){t.rd=n.redirectEnd-n.redirectStart}if(t.or>0){var r=typeof e.d=="number"?e.d:e.d.getTime();t.rr=t.or+r-n.domLoading;t.ar=t.or+r-n.navigationStart}if(this.p.getEntriesByType){var a=this.p.getEntriesByType("paint");var i=this.p.getEntriesByType("resource");a&&a.forEach(function(e){if(e.name=="first-paint"){t.fp=e.startTime||-1}else if(e.name=="first-contentful-paint"){t.fcp=e.startTime||-1}});t.rl=i&&i.length||-1}}t.r=t.rr>-1?t.rr:0;g.setWebPerfLog(t.r,t.fp,t.rl);return t}};var g={inited:false,setWebPerfLog:function(t,n,r){this.call("setWebPerfLog",{url:e.location.href,time:t,firstPaint:n,resourceLength:r},function(){})},call:function(e,t,n){this.ready(function(r){r.callHandler(e,t,n)})},ready:function(t){var n=this;if(e.G&&e.G.isApp){e.G.webviewBridgeReady(t)}}};var h=false;var y=function(e){if(h)return;h=true;r=v.format(r);r.f=d*1e3/(new Date-o)>>0;var t=new XMLHttpRequest;var a=[];for(var i in r){a.push(i+"="+encodeURIComponent(r[i]))}a=a.join("&");if(p()){return m(n+"//api.tuniu.com/stat/save?"+a)}t.open("get",n+"//api.tuniu.com/stat/save?"+a,e||false);t.send(null)};l(e,"beforeunload",y);l(e,"unload",y);setTimeout(function(){y(true)},1e4);e.PERFORMANCE=r;f()}(window);